
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Generate and refine AI-created images for advertising."/>
    <meta name="author" content="Victory Vision"/>
    <title>Victory Vision AI - Smart Image Generator</title>
    <link rel="stylesheet" href="style.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script defer src="scripts.js"></script>
</head>
<body>
<header class="navbar">
    <div class="logo"><img src="logo.jpg" alt="Victory Vision Logo"/></div>
    <nav>
        <ul>
            <li><a href="ai-opt">ü§ñ‚åÇ</a></li>
            <li><a href="dashboard">KPI's</a></li> 
            <li><a href="images">Images</a></li>
            <li><a href="videos">Videos</a></li>
            <li><a href="pages">Pages</a></li>
            <li><a href="ads">Ads</a></li>
            <li><a href="leads">Leads</a></li>
            <li><a href="social">Social</a></li>
            <li><a href="messages">Messages</a></li>
            <li><a href="settings">‚öôÔ∏è</a></li>
        </ul>
    </nav>
</header>

<div class="content">
    <div class="card">
        <h2>Create or Refine Ad Image</h2>
        <textarea id="imagePrompt" placeholder="Enter your prompt..."></textarea>
        <input type="file" id="imageUpload" accept="image/*">
        <button onclick="generateImage()">Generate / Analyze</button>
        <div id="suggested-tags"></div>
        <div id="refinement-desc" style="margin-top:10px;color:#777;"></div>
    </div>

    <div class="card">
        <h3>Image Results</h3>
        <div id="imageResults" class="image-gallery"></div>
    </div>
</div>

<footer style="background:#0A3161;color:#fff;text-align:center;padding:15px;">
    <p>&copy; 2025 Victory Vision Digital Out of Home. All rights reserved.</p>
    <nav>
        <a href="privacy.html" style="color:#fff;margin-right:15px;">Privacy Policy</a>
        <a href="terms.html" style="color:#fff;">Terms of Service</a>
    </nav>
</footer>

<script>
    async function generateImage() {
        const prompt = document.getElementById('imagePrompt').value;
        const fileInput = document.getElementById('imageUpload').files[0];
        const tagsDiv = document.getElementById("suggested-tags");
        const descDiv = document.getElementById("refinement-desc");
        tagsDiv.innerHTML = '';
        descDiv.innerHTML = '';
        let imageBase64 = null;

        showLoader();

        if (fileInput) {
            const reader = new FileReader();
            reader.onload = async () => {
                imageBase64 = reader.result.split(',')[1];
                await sendRequest(prompt, imageBase64);
            };
            reader.readAsDataURL(fileInput);
        } else {
            await sendRequest(prompt, null);
        }
    }

    async function sendRequest(prompt, image) {
        const response = await fetch('https://victoryvision.app.n8n.cloud/webhook/image-generator', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                prompt: prompt,
                customer_id: "client-xyz",
                image: image
            })
        });

        const data = await response.json();
        const gallery = document.getElementById("imageResults");
        gallery.innerHTML = '';

        if (data.images) {
            data.images.forEach((url, index) => {
                const container = document.createElement("div");
                container.style.margin = "10px";

                const img = document.createElement("img");
                img.src = url;
                img.style.width = "200px";
                img.classList.add("animated-glow");

                const input = document.createElement("input");
                input.placeholder = "Enter collection name";
                input.style.marginTop = "5px";
                input.id = "collection_" + index;

                const saveBtn = document.createElement("button");
                saveBtn.innerText = "üíæ Save";
                saveBtn.onclick = () => saveToCollection(url, input.value);

                const dlBtn = document.createElement("button");
                dlBtn.innerText = "üì• Download";
                dlBtn.onclick = () => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = "ai-image.jpg";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                };

                container.appendChild(img);
                container.appendChild(document.createElement("br"));
                container.appendChild(input);
                container.appendChild(saveBtn);
                container.appendChild(dlBtn);
                gallery.appendChild(container);
            });
        }

        if (data.suggestions) {
            const tagsDiv = document.getElementById("suggested-tags");
            tagsDiv.innerHTML = '<strong>Enhance with:</strong><br>';
            data.suggestions.forEach(tag => {
                const btn = document.createElement("button");
                btn.innerText = tag;
                btn.onclick = () => {
                    document.getElementById('imagePrompt').value += ' ' + tag;
                };
                btn.style.margin = '4px';
                tagsDiv.appendChild(btn);
            });
            animateTags();
        }

        if (data.description) {
            const descEl = document.getElementById("refinement-desc");
            typeWriterEffect(descEl, "AI Analysis: " + data.description, 20);
        }
    }

    async function saveToCollection(imageUrl, collectionName) {
        if (!collectionName) {
            alert("Please enter a collection name.");
            return;
        }
        await fetch("https://victoryvision.app.n8n.cloud/webhook/save-to-collection", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                image_url: imageUrl,
                collection_name: collectionName,
                customer_id: "client-xyz"
            })
        });
        alert("Saved to collection: " + collectionName);
    }
</script>
</body>
</html>
