<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Manage your contacts and email workflows."/>
  <meta name="author" content="Victory Vision"/>
  <title>Victory Vision AI - Contacts</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/introjs.min.css">
  <script src="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/intro.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    .navbar {
      background-color: #0A3161;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .navbar nav ul {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .navbar nav ul li {
      margin: 0 10px;
    }
    .navbar nav ul li a {
      color: white;
      text-decoration: none;
    }
    .navbar .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .subscription-medallion {
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(45deg, #CD7F32, #A0522D);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      position: relative;
      border: none;
      transition: all 0.3s ease;
    }
    .subscription-medallion.bronze {
      background: linear-gradient(45deg, #CD7F32, #A0522D);
    }
    .subscription-medallion.silver {
      background: linear-gradient(45deg, #C0C0C0, #808080);
    }
    .subscription-medallion.gold {
      background: linear-gradient(45deg, #FFD700, #FFA500);
    }
    .subscription-medallion:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .subscription-medallion .plan-name {
      font-weight: bold;
    }
    .logo img {
      height: 60px;
      width: auto;
      max-height: 100px;
    }
    .content {
      padding: 20px 4px;
      max-width: 1600px;
      margin: 0 auto;
    }
    .page-header {
      margin-bottom: 30px;
    }
    .page-title {
      font-size: 2.5rem;
      font-weight: bold;
      color: #0A3161;
      margin-bottom: 0.5rem;
    }
    .page-subtitle {
      font-size: 1.1rem;
      color: #666;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .section-header {
      background: linear-gradient(135deg, #0A3161, #1a4c80);
      color: white;
      padding: 15px;
      margin: -20px -20px 20px -20px;
      border-radius: 8px 8px 0 0;
    }
    .credits-display {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
      text-align: center;
    }
    .credits-number {
      font-size: 1.4em;
      font-weight: bold;
      color: #0A3161;
    }
    .credits-label {
      font-size: 0.85em;
      color: #666;
      margin-top: 2px;
    }
    .linkedin-input-section {
      display: grid;
      grid-template-columns: 1fr 150px;
      gap: 15px;
      margin-bottom: 20px;
      align-items: end;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
      position: relative;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    .form-group input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .generate-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      display: block;
      margin: 20px auto;
    }
    .generate-btn:hover {
      background: linear-gradient(135deg, #218838, #1e7e34);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .generate-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }
    .add-contact-section {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    button {
      background: #0A3161;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 2px;
    }
    button:hover {
      background: #083050;
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #5a6268;
    }
    button.danger {
      background: #dc3545;
    }
    button.danger:hover {
      background: #c82333;
    }
    button.success {
      background: #28a745;
    }
    button.success:hover {
      background: #218838;
    }
    /* Updated filter section to match media page design */
    .filter-section {
      display: grid;
      grid-template-columns: 200px 200px 200px 200px 200px 200px auto auto;
      gap: 15px;
      align-items: end;
      margin-bottom: 20px;
    }
    .bulk-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center;
      flex-wrap: wrap;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #dee2e6;
      justify-content: space-between;
    }
    .bulk-actions-left {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .bulk-actions-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .workflow-section {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px solid #bb133e;
    }
    .workflow-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    .workflow-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    .workflow-item:hover {
      background: #f0f8ff;
      border-color: #0A3161;
    }
    .workflow-item input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .workflow-item label {
      margin: 0;
      cursor: pointer;
      flex: 1;
    }
    .column-selector {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #dee2e6;
    }
    .column-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }
    .column-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }
    .column-item input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .table-container {
      overflow-x: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-height: 70vh;
      overflow-y: auto;
    }
    .contacts-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1600px;
    }
    .contacts-table th,
    .contacts-table td {
      padding: 12px 8px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
      font-size: 13px;
      white-space: nowrap;
    }
    .contacts-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #0A3161;
      position: sticky;
      top: 0;
      z-index: 10;
      cursor: pointer;
    }
    .contacts-table th:hover {
      background: #e9ecef;
    }
    .contacts-table tr:hover {
      background-color: #f8f9fa;
    }
    .contacts-table tbody tr {
      cursor: pointer;
    }
    .checkbox-cell {
      width: 40px;
      text-align: center;
    }
    .contact-name {
      font-weight: 600;
      color: #0A3161;
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .revenue-cell {
      color: #28a745;
      font-weight: 600;
    }
    .workflow-badge {
      background: #e3f2fd;
      color: #1976d2;
      padding: 2px 6px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 500;
      display: inline-block;
      margin: 1px;
    }
    .workflow-badge.active {
      background: #28a745;
      color: white;
    }
    .sort-indicator {
      display: inline-block;
      margin-left: 5px;
      opacity: 0.5;
    }
    .sort-indicator.active {
      opacity: 1;
    }
    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.1rem;
      color: #666;
    }
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #666;
    }
    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: #0A3161;
    }
    .status-message {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      display: none;
      position: fixed;
      top: 80px;
      right: 20px;
      max-width: 400px;
      z-index: 1000;
    }
    .status-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 0;
      border-radius: 8px;
      width: 95%;
      max-width: 1000px;
      max-height: 95vh;
      overflow-y: auto;
    }
    .modal-header {
      background: linear-gradient(135deg, #0A3161, #1a4c80);
      color: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .close {
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      opacity: 0.8;
    }
    .modal-body {
      padding: 20px;
    }
    .contact-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .detail-group {
      margin-bottom: 15px;
    }
    .detail-label {
      font-weight: bold;
      color: #0A3161;
      margin-bottom: 5px;
      font-size: 12px;
      text-transform: uppercase;
    }
    .detail-value {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      min-height: 20px;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #dee2e6;
      flex-wrap: wrap;
    }
    footer {
      background: #0A3161;
      color: #fff;
      text-align: center;
      padding: 15px;
      margin-top: 20px;
    }
    footer a {
      color: #fff;
      margin-right: 15px;
      text-decoration: none;
    }
    
    /* Help icon styles */
    .help-icon {
      position: relative;
      display: inline-block;
      margin-left: 5px;
      cursor: pointer;
      color: #6c757d;
      font-size: 14px;
      user-select: none;
    }
    
    .help-tooltip {
      visibility: hidden;
      width: 250px;
      background-color: #333;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1001;
      bottom: 125%;
      left: 50%;
      margin-left: -125px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.4;
    }
    
    .help-tooltip::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #333 transparent transparent transparent;
    }
    
    .help-icon:hover .help-tooltip {
      visibility: visible;
      opacity: 1;
    }
    
    /* Date filter styles */
    .date-filter-group {
      display: flex;
      gap: 5px;
      align-items: end;
    }
    
    .date-filter-group input[type="date"] {
      width: 130px;
      font-size: 12px;
      padding: 6px;
    }
    
    /* Intro.js custom styling */
    .introjs-tooltip {
      max-width: 350px;
      font-size: 14px;
    }

    .introjs-button {
      background: #0A3161 !important;
      border: 1px solid #0A3161 !important;
      color: white !important;
      padding: 8px 15px !important;
      border-radius: 4px !important;
    }

    .introjs-button:hover {
      background: #083050 !important;
      border-color: #083050 !important;
    }

    .introjs-skipbutton {
      background: #6c757d !important;
      border-color: #6c757d !important;
    }

    .introjs-progressbar {
      background-color: #0A3161 !important;
    }
    
    @media (max-width: 1024px) {
      .filter-section {
        grid-template-columns: repeat(2, 1fr);
      }
      .workflow-list {
        grid-template-columns: 1fr;
      }
      .bulk-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .bulk-actions-left,
      .bulk-actions-right {
        justify-content: center;
      }
    }
    
    @media (max-width: 768px) {
      .content {
        padding: 10px 5px;
      }
      .page-title {
        font-size: 2rem;
      }
      .linkedin-input-section {
        grid-template-columns: 1fr;
      }
      .filter-section {
        grid-template-columns: 1fr;
      }
      .bulk-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .modal-content {
        width: 98%;
        margin: 5% auto;
      }
      .add-contact-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<header class="navbar">
  <div class="logo">
    <img src="logo.jpg" alt="Victory Vision Logo"
         onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect width=%2240%22 height=%2240%22 fill=%22%230A3161%22 /><text x=%225%22 y=%2225%22 font-size=%2220%22 fill=%22white%22>VV</text></svg>'"/>
  </div>
  <nav>
    <ul>
      <li><a href="companyprofile">Profile</a></li>
      <li><a href="campaigns">Campaigns</a></li>
      <li><a href="media">Media</a></li>
      <li><a href="pages">Pages</a></li>
      <li><a href="social">Social</a></li>
      <li><a href="contacts">Contacts</a></li>
      <li><a href="ads">Ads</a></li>
      <li><a href="messages">Messages</a></li>
      <li><a href="meetings">Meetings</a></li>
      <li><a href="ai">Analytics</a></li>
      <li><a href="settings">Settings</a></li>
    </ul>
  </nav>
  <div class="user-info">
    <span id="userEmail"></span>
    <button onclick="startTour()" style="background: #28a745; padding: 6px 12px; font-size: 11px; margin-left: 10px;" id="tourButton">
      üìñ Take Tour
    </button>
    <div id="subscriptionMedallion" class="subscription-medallion bronze">
      <span class="plan-name">Bronze</span>
      <span class="credits" id="contactCredits">20 contacts</span>
    </div>
  </div>
</header>

<div class="content">
  <header class="page-header">
    <h1 class="page-title">Contact Management</h1>
    <p class="page-subtitle">Generate new contacts and manage your prospect database with AI workflows</p>
  </header>

  <!-- Lead Generation Section -->
  <section class="card">
    <div class="section-header">
      <h3>üéØ Generate New Contacts</h3>
    </div>
    
    <div class="credits-display">
      <div class="credits-number" id="contactCreditsDisplay">Loading...</div>
      <div class="credits-label">Contact Credits Remaining</div>
    </div>
    
    <p style="margin-bottom: 20px; color: #666;">
      Enter a LinkedIn profile URL of your ideal customer and specify how many similar contacts you want to generate.
    </p>
    
    <div class="linkedin-input-section">
      <div class="form-group">
        <label for="linkedin1">LinkedIn Profile URL</label>
        <input type="url" id="linkedin1" placeholder="https://linkedin.com/in/profile-name">
      </div>
      <div class="form-group">
        <label for="leadCount">Number of Leads</label>
        <select id="leadCount">
          <option value="1">1 Lead</option>
          <option value="5" selected>5 Leads</option>
          <option value="10">10 Leads</option>
          <option value="15">15 Leads</option>
          <option value="20">20 Leads</option>
        </select>
      </div>
    </div>
    
    <button id="generateBtn" class="generate-btn">üöÄ Generate New Contacts</button>
    
    <!-- Add Contacts Section -->
    <div class="add-contact-section">
      <button onclick="showAddContactModal()" class="success">‚ûï Add Contact Manually</button>
      <button onclick="document.getElementById('csvFileInput').click()" class="secondary">üìÑ Upload CSV</button>
      <button onclick="downloadSampleCSV()" class="info">üì• Download Sample CSV</button>
    </div>
    
    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
    
    <!-- CSV Sample Section -->
    <div class="csv-sample">
      <h4>üìã Sample CSV Format</h4>
      <code>email,name,logo_url,phone,linkedin,company,conversation_summary,city,industry,tags
john@company.com,"John Smith","https://company.com/logo.png","+1-555-0123","https://linkedin.com/in/john-smith","Company Inc","Initial discussion about needs","San Francisco","Technology","hot-lead,decision-maker"
jane@startup.com,"Jane Doe","https://startup.com/logo.png","+1-555-0124","https://linkedin.com/in/jane-doe","Startup LLC","Interested in our solution","New York","Healthcare","qualified,interested"</code>
    </div>
  </section>

  <!-- Contacts Management Section -->
  <section class="card">
    <div class="section-header">
      <h3>üë• Your Contacts Database</h3>
    </div>
    
    <!-- Email Workflows Section (UPDATED - removed newsletter signup) -->
    <div class="workflow-section">
      <h4 style="margin: 0 0 15px 0; color: #0A3161;">üìß Available Email Workflows</h4>
      <div class="workflow-list" id="workflowList">
        <div class="workflow-item">
          <input type="checkbox" id="workflow_ads" value="ads">
          <label for="workflow_ads">üì∫ Ad Outreach - Share hyper personalized ads</label>
        </div>
        <div class="workflow-item">
          <input type="checkbox" id="workflow_nurture" value="nurture">
          <label for="workflow_nurture">üå± Lead Nurture - Educational content sequence</label>
        </div>
        <div class="workflow-item">
          <input type="checkbox" id="workflow_meeting" value="meeting">
          <label for="workflow_meeting">üìÖ Schedule Meeting Request</label>
        </div>
        <div class="workflow-item">
          <input type="checkbox" id="workflow_followup" value="followup">
          <label for="workflow_followup">üîÑ Follow-up Sequence - Re-engage prospects</label>
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button onclick="showCustomEmailModal()" class="warning">üé® Create Custom Email Campaign</button>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <div class="form-group">
        <label for="searchFilter">Search</label>
        <input type="text" id="searchFilter" placeholder="Search contacts...">
      </div>
      <div class="form-group">
        <label for="industryFilter">Industry</label>
        <select id="industryFilter">
          <option value="">All Industries</option>
        </select>
      </div>
      <div class="form-group">
        <label for="cityFilter">City</label>
        <select id="cityFilter">
          <option value="">All Cities</option>
        </select>
      </div>
      <div class="form-group">
        <label for="revenueFilter">Revenue</label>
        <select id="revenueFilter">
          <option value="">All Revenue</option>
          <option value="0-1M">$0-1M</option>
          <option value="1M-10M">$1M-10M</option>
          <option value="10M-50M">$10M-50M</option>
          <option value="50M+">$50M+</option>
        </select>
      </div>
      <button id="refreshBtn">üîÑ Refresh</button>
      <button id="clearFiltersBtn" class="secondary">Clear Filters</button>
    </div>

    <!-- Bulk Actions -->
    <div class="bulk-actions">
      <div class="bulk-actions-left">
        <button id="selectAllBtn" class="secondary">Select All</button>
        <button id="deselectAllBtn" class="secondary">Deselect All</button>
        <button id="enrollWorkflowsBtn" class="success">üìß Enroll in Workflows</button>
        <button id="enrichContactsBtn" class="success">üîç Enrich Selected</button>
        <button id="deleteSelectedBtn" class="danger">üóëÔ∏è Delete Selected</button>
        <span id="selectedCount" style="margin-left: 10px; color: #666;">0 selected</span>
      </div>
    </div>

    <!-- Contacts Table -->
    <div class="table-container">
      <table class="contacts-table">
        <thead>
          <tr id="tableHeader">
            <th class="checkbox-cell">
              <input type="checkbox" id="selectAllCheckbox">
            </th>
            <th>Name</th>
            <th>Email</th>
            <th>Company</th>
            <th>Industry</th>
            <th>City</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="contactsTableBody">
          <tr>
            <td colspan="7" class="loading">Loading your contacts...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Status Messages -->
  <div id="statusMessage" class="status-message"></div>
</div>

<!-- Contact Details Modal -->
<div id="contactModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitle">Contact Details</h2>
      <span class="close" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Contact details will be loaded here -->
    </div>
  </div>
</div>

<!-- Add Contact Modal -->
<div id="addContactModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>‚ûï Add New Contact</h2>
      <span class="close" onclick="closeAddContactModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="addContactForm">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label for="name">Full Name *</label>
            <input type="text" id="name" name="name" required placeholder="John Smith">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="john@company.com">
          </div>
          <div class="form-group">
            <label for="company">Company</label>
            <input type="text" id="company" name="company" placeholder="Company Inc">
          </div>
          <div class="form-group">
            <label for="phone_number">Phone</label>
            <input type="tel" id="phone_number" name="phone_number" placeholder="+1-555-0123">
          </div>
          <div class="form-group">
            <label for="linkedin">LinkedIn URL</label>
            <input type="url" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/profile">
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" placeholder="San Francisco">
          </div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" onclick="closeAddContactModal()" class="secondary">Cancel</button>
          <button type="submit" class="success">‚ûï Add Contact</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Custom Email Campaign Modal -->
<div id="customEmailModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>üé® Create Custom Email Campaign</h2>
      <span class="close" onclick="closeCustomEmailModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="customEmailForm">
        <div class="form-group">
          <label for="campaignName">Campaign Name *</label>
          <input type="text" id="campaignName" name="campaignName" required placeholder="Q1 Product Launch Campaign">
        </div>
        
        <div class="form-group">
          <label for="emailCount">Number of Emails *</label>
          <select id="emailCount" name="emailCount" required>
            <option value="">Select number of emails</option>
            <option value="1">1 Email</option>
            <option value="2">2 Emails</option>
            <option value="3">3 Emails</option>
            <option value="4">4 Emails</option>
            <option value="5">5 Emails</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="campaignDescription">Campaign Description *</label>
          <textarea id="campaignDescription" name="campaignDescription" required placeholder="Describe the goal and tone of this email campaign. AI will use this to generate personalized emails for each contact." rows="4"></textarea>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" onclick="closeCustomEmailModal()" class="secondary">Cancel</button>
          <button type="submit" class="warning">üöÄ Create & Send Campaign</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Contact Actions Modal -->
<div id="contactActionsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="actionsModalTitle">Contact Actions</h2>
      <span class="close" onclick="closeContactActionsModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <button onclick="sendEmailToContact()" class="info" style="padding: 20px; font-size: 16px;">
          ‚úâÔ∏è Send Email
        </button>
        <button onclick="createMeetingForContact()" class="success" style="padding: 20px; font-size: 16px;">
          üìÖ Schedule Meeting
        </button>
        <button onclick="createSMSForContact()" class="warning" style="padding: 20px; font-size: 16px;">
          üì± Send SMS
        </button>
        <button onclick="makeCallToContact()" class="info" style="padding: 20px; font-size: 16px;">
          üìû Make Call
        </button>
        <button onclick="editContact()" class="secondary" style="padding: 20px; font-size: 16px;">
          ‚úèÔ∏è Edit Contact
        </button>
      </div>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2025 Victory Vision Digital Out of Home. All rights reserved.</p>
  <nav>
    <a href="privacy.html">Privacy Policy</a>
    <a href="terms.html">Terms of Service</a>
  </nav>
</footer>

<script>
// API endpoints with new additions
const ENDPOINTS = {
  getUserData: 'https://victoryvision.app.n8n.cloud/webhook/user/get',
  getContacts: 'https://victoryvision.app.n8n.cloud/webhook/contacts/get',
  generateContacts: 'https://victoryvision.app.n8n.cloud/webhook/contacts/look',
  addContact: 'https://victoryvision.app.n8n.cloud/webhook/contacts/add',
  updateContact: 'https://victoryvision.app.n8n.cloud/webhook/contacts/update',
  enrichContacts: 'https://victoryvision.app.n8n.cloud/webhook/contacts/enrich',
  uploadCSV: 'https://victoryvision.app.n8n.cloud/webhook/contacts/upload-csv',
  enrollAds: 'https://victoryvision.app.n8n.cloud/webhook/emails/ad-campaign',
  enrollNurture: 'https://victoryvision.app.n8n.cloud/webhook/emails/nurture',
  enrollMeeting: 'https://victoryvision.app.n8n.cloud/webhook/emails/meeting',
  enrollFollowup: 'https://victoryvision.app.n8n.cloud/webhook/emails/followup',
  createCustomEmail: 'https://victoryvision.app.n8n.cloud/webhook/emails/usergenerated',
  createPresentation: 'https://victoryvision.app.n8n.cloud/webhook/presentations/create',
  createSMS: 'https://victoryvision.app.n8n.cloud/webhook/sms/create',
  makeCall: 'https://victoryvision.app.n8n.cloud/webhook/call/make',
  removeContact: 'https://victoryvision.app.n8n.cloud/webhook/contacts/remove'
};

// Global variables
let CUSTOMER_ID = null;
let authToken = null;
let userCredits = { contact_credits: 0, video_credits: 0 };
let allContacts = [];
let filteredContacts = [];
let selectedContacts = new Set();
let currentContact = null;

// Supabase configuration
const supabaseUrl = 'https://nyyvsdkumxvuwimmucdb.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55eXZzZGt1bXh2dXdpbW11Y2RiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM3MzY5OTQsImV4cCI6MjA1OTMxMjk5NH0.7m7R_8mBhp7X8itl5cR81xbX2AjJUm2SIPR0FUv6ouU';
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

// Download sample CSV
function downloadSampleCSV() {
  const csvContent = `email,name,logo_url,phone,linkedin,company,conversation_summary,city,industry,tags
john@company.com,"John Smith","https://company.com/logo.png","+1-555-0123","https://linkedin.com/in/john-smith","Company Inc","Initial discussion about needs","San Francisco","Technology","hot-lead,decision-maker"
jane@startup.com,"Jane Doe","https://startup.com/logo.png","+1-555-0124","https://linkedin.com/in/jane-doe","Startup LLC","Interested in our solution","New York","Healthcare","qualified,interested"
mike@enterprise.com,"Mike Johnson","https://enterprise.com/logo.png","+1-555-0125","https://linkedin.com/in/mike-johnson","Enterprise Corp","Needs enterprise solution","Chicago","Finance","enterprise,warm-lead"`;

  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  link.setAttribute('href', url);
  link.setAttribute('download', 'contacts_sample.csv');
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Authentication
async function checkAuthentication() {
  try {
    const { data: { session }, error } = await supabaseClient.auth.getSession();
    
    if (error) {
      console.error('Auth error:', error);
      return false;
    }

    if (session && session.user) {
      CUSTOMER_ID = session.user.email;
      authToken = session.access_token;
      document.getElementById('userEmail').textContent = CUSTOMER_ID;
      return true;
    }

    return false;
  } catch (e) {
    console.error('Auth check error:', e);
    return false;
  }
}

// API call function
async function apiCall(endpoint, data = {}) {
  try {
    const url = endpoint.includes('/user/get') ? 
      `${endpoint}?customer_id=${encodeURIComponent(CUSTOMER_ID)}` : 
      endpoint;
    
    const requestOptions = {
      method: endpoint.includes('/user/get') ? 'GET' : 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Customer-ID': CUSTOMER_ID,
        'Authorization': authToken ? `Bearer ${authToken}` : ''
      }
    };

    if (!endpoint.includes('/user/get')) {
      requestOptions.body = JSON.stringify({
        customer_id: CUSTOMER_ID,
        ...data
      });
    }

    const response = await fetch(url, requestOptions);
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    return await response.json();
  } catch (error) {
    console.error('API call failed:', error);
    throw error;
  }
}

// Load contacts
async function loadContacts() {
  try {
    const data = await apiCall(ENDPOINTS.getContacts);
    allContacts = Array.isArray(data) ? data : (data.contacts || []);
    filteredContacts = [...allContacts];
    renderContactsTable();
    showStatus(`Loaded ${allContacts.length} contacts`, false);
  } catch (error) {
    console.error('Error loading contacts:', error);
    showStatus('Error loading contacts: ' + error.message, true);
    allContacts = [];
    filteredContacts = [];
    renderContactsTable();
  }
}

// Render contacts table
function renderContactsTable() {
  const tbody = document.getElementById('contactsTableBody');
  
  if (filteredContacts.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align: center; padding: 3rem; color: #666;">
          <h3>No contacts found</h3>
          <p>Generate new contacts or adjust your filters.</p>
        </td>
      </tr>
    `;
    return;
  }

  tbody.innerHTML = filteredContacts.map(contact => {
    const contactId = contact.id || contact.contact_id || contact.email;
    
    return `
      <tr data-contact-id="${contactId}">
        <td class="checkbox-cell">
          <input type="checkbox" 
                 value="${contactId}" 
                 ${selectedContacts.has(contactId) ? 'checked' : ''}
                 onchange="toggleContactSelection('${contactId}')">
        </td>
        <td>${contact.name || 'N/A'}</td>
        <td>${contact.email || 'N/A'}</td>
        <td>${contact.company || 'N/A'}</td>
        <td>${contact.industry || 'N/A'}</td>
        <td>${contact.city || 'N/A'}</td>
        <td>
          <button onclick="showContactActionsModal('${contactId}')" class="info" style="padding: 5px 10px; font-size: 12px;">
            Actions
          </button>
        </td>
      </tr>
    `;
  }).join('');
}

// Modal functions
function showAddContactModal() {
  document.getElementById('addContactModal').style.display = 'block';
}

function closeAddContactModal() {
  document.getElementById('addContactModal').style.display = 'none';
  document.getElementById('addContactForm').reset();
}

function showCustomEmailModal() {
  if (selectedContacts.size === 0) {
    showStatus('Please select contacts to send the custom email campaign to', true);
    return;
  }
  document.getElementById('customEmailModal').style.display = 'block';
}

function closeCustomEmailModal() {
  document.getElementById('customEmailModal').style.display = 'none';
  document.getElementById('customEmailForm').reset();
}

function showContactActionsModal(contactId) {
  const contact = allContacts.find(c => 
    c.contact_id === contactId || 
    c.id === contactId || 
    c.email === contactId
  );
  
  if (!contact) {
    showStatus('Contact not found', true);
    return;
  }
  
  currentContact = contact;
  document.getElementById('actionsModalTitle').textContent = `Actions for ${contact.name || 'Contact'}`;
  document.getElementById('contactActionsModal').style.display = 'block';
}

function closeContactActionsModal() {
  document.getElementById('contactActionsModal').style.display = 'none';
  currentContact = null;
}

function closeModal() {
  document.getElementById('contactModal').style.display = 'none';
  currentContact = null;
}

// Contact actions
async function sendEmailToContact() {
  if (!currentContact || !currentContact.email) {
    showStatus('Contact email not available', true);
    return;
  }
  
  sessionStorage.setItem('composeToEmail', currentContact.email);
  sessionStorage.setItem('composeToName', currentContact.name || '');
  window.location.href = '/messages';
  closeContactActionsModal();
}

async function createMeetingForContact() {
  if (!currentContact) {
    showStatus('No contact selected', true);
    return;
  }
  
  try {
    const result = await apiCall(ENDPOINTS.createMeeting, {
      contact: {
        email: currentContact.email,
        name: currentContact.name,
        company: currentContact.company
      }
    });
    
    showStatus(`Meeting request sent to ${currentContact.name}`, false);
    closeContactActionsModal();
  } catch (error) {
    console.error('Error creating meeting:', error);
    showStatus('Error creating meeting: ' + error.message, true);
  }
}

async function createSMSForContact() {
  if (!currentContact) {
    showStatus('No contact selected', true);
    return;
  }
  
  try {
    const result = await apiCall(ENDPOINTS.createSMS, {
      contact: {
        phone: currentContact.phone_number,
        name: currentContact.name,
        company: currentContact.company
      }
    });
    
    showStatus(`SMS sent to ${currentContact.name}`, false);
    closeContactActionsModal();
  } catch (error) {
    console.error('Error sending SMS:', error);
    showStatus('Error sending SMS: ' + error.message, true);
  }
}

async function makeCallToContact() {
  if (!currentContact) {
    showStatus('No contact selected', true);
    return;
  }
  
  try {
    const result = await apiCall(ENDPOINTS.makeCall, {
      contact: {
        phone: currentContact.phone_number,
        name: currentContact.name,
        company: currentContact.company
      }
    });
    
    showStatus(`Call initiated to ${currentContact.name}`, false);
    closeContactActionsModal();
  } catch (error) {
    console.error('Error making call:', error);
    showStatus('Error making call: ' + error.message, true);
  }
}

function editContact() {
  closeContactActionsModal();
  showAddContactModal();
  
  // Populate form with existing data
  document.getElementById('name').value = currentContact.name || '';
  document.getElementById('email').value = currentContact.email || '';
  document.getElementById('company').value = currentContact.company || '';
  document.getElementById('phone_number').value = currentContact.phone_number || '';
  document.getElementById('linkedin').value = currentContact.linkedin || '';
  document.getElementById('city').value = currentContact.city || '';
  
  // Change modal title
  document.querySelector('#addContactModal .modal-header h2').textContent = '‚úèÔ∏è Edit Contact';
  document.querySelector('#addContactModal button[type="submit"]').textContent = 'üíæ Update Contact';
}

// Contact selection
function toggleContactSelection(contactId) {
  if (selectedContacts.has(contactId)) {
    selectedContacts.delete(contactId);
  } else {
    selectedContacts.add(contactId);
  }
  updateSelectedCount();
}

function updateSelectedCount() {
  document.getElementById('selectedCount').textContent = `${selectedContacts.size} selected`;
}

// Status messages
function showStatus(message, isError = false) {
  const statusDiv = document.getElementById('statusMessage');
  statusDiv.textContent = message;
  statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
  statusDiv.style.display = 'block';
  
  setTimeout(() => {
    statusDiv.style.display = 'none';
  }, 5000);
}

// Event listeners
document.addEventListener('DOMContentLoaded', async function() {
  const isAuthenticated = await checkAuthentication();
  
  if (isAuthenticated) {
    await loadContacts();
    
    // Form submissions
    document.getElementById('addContactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      try {
        const contactData = {};
        for (let [key, value] of formData.entries()) {
          contactData[key] = value;
        }
        
        const result = await apiCall(ENDPOINTS.addContact, contactData);
        showStatus('Contact added successfully!', false);
        closeAddContactModal();
        await loadContacts();
      } catch (error) {
        showStatus('Error adding contact: ' + error.message, true);
      }
    });
    
    document.getElementById('customEmailForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      try {
        const campaignData = {
          campaign_name: formData.get('campaignName'),
          email_count: parseInt(formData.get('emailCount')),
          campaign_description: formData.get('campaignDescription'),
          contacts: Array.from(selectedContacts).map(id => 
            allContacts.find(c => c.id === id || c.contact_id === id || c.email === id)
          ).filter(c => c && c.email)
        };

        const result = await apiCall(ENDPOINTS.createCustomEmail, campaignData);
        showStatus(`Custom email campaign "${campaignData.campaign_name}" created!`, false);
        closeCustomEmailModal();
        selectedContacts.clear();
        updateSelectedCount();
      } catch (error) {
        showStatus('Error creating custom email campaign: ' + error.message, true);
      }
    });
    
  } else {
    window.location.href = 'login.html';
  }
});

// Generate new contacts
document.getElementById('generateBtn').addEventListener('click', async function() {
  const generateBtn = this;
  
  try {
    generateBtn.disabled = true;
    generateBtn.textContent = 'üîÑ Generating Contacts...';
    
    const linkedinUrl = document.getElementById('linkedin1').value.trim();
    const leadCount = parseInt(document.getElementById('leadCount').value) || 5;

    if (!linkedinUrl) {
      throw new Error('Please enter a LinkedIn URL');
    }

    const result = await apiCall(ENDPOINTS.generateContacts, { 
      linkedin_urls: [linkedinUrl],
      lead_count: leadCount
    });

    showStatus(`Successfully generating ${leadCount} contacts! They will appear shortly.`, false);
    
    // Clear inputs
    document.getElementById('linkedin1').value = '';
    document.getElementById('leadCount').value = '5';
    
    // Reload contacts after a delay
    setTimeout(() => {
      loadContacts();
    }, 3000);
    
  } catch (error) {
    console.error('Error generating contacts:', error);
    showStatus(error.message || 'Error generating contacts', true);
  } finally {
    generateBtn.disabled = false;
    generateBtn.textContent = 'üöÄ Generate New Contacts';
  }
});

// CSV upload
document.getElementById('csvFileInput').addEventListener('change', async function(event) {
  const file = event.target.files[0];
  if (!file) return;

  if (!file.name.endsWith('.csv')) {
    showStatus('Please select a CSV file', true);
    return;
  }

  try {
    const csvText = await file.text();
    const result = await apiCall(ENDPOINTS.uploadCSV, { 
      csv_data: csvText,
      filename: file.name
    });

    showStatus(`CSV uploaded successfully! Processing contacts.`, false);
    await loadContacts();
  } catch (error) {
    console.error('Error uploading CSV:', error);
    showStatus('Error uploading CSV: ' + error.message, true);
  }

  event.target.value = '';
});

// Bulk actions
document.getElementById('selectAllBtn').addEventListener('click', function() {
  filteredContacts.forEach(contact => {
    const id = contact.id || contact.contact_id || contact.email;
    selectedContacts.add(id);
  });
  renderContactsTable();
  updateSelectedCount();
});

document.getElementById('deselectAllBtn').addEventListener('click', function() {
  selectedContacts.clear();
  renderContactsTable();
  updateSelectedCount();
});

document.getElementById('enrollWorkflowsBtn').addEventListener('click', async function() {
  const selectedWorkflows = Array.from(document.querySelectorAll('#workflowList input[type="checkbox"]:checked'))
    .map(cb => cb.value);
  
  if (selectedContacts.size === 0) {
    showStatus('Please select contacts to enroll', true);
    return;
  }
  
  if (selectedWorkflows.length === 0) {
    showStatus('Please select at least one workflow', true);
    return;
  }
  
  try {
    const selectedContactsList = Array.from(selectedContacts).map(id => 
      allContacts.find(c => c.id === id || c.contact_id === id || c.email === id)
    ).filter(c => c && c.email);

    for (const workflow of selectedWorkflows) {
      let endpoint;
      
      switch(workflow) {
        case 'ads':
          endpoint = ENDPOINTS.enrollAds;
          break;
        case 'nurture':
          endpoint = ENDPOINTS.enrollNurture;
          break;
        case 'meeting':
          endpoint = ENDPOINTS.enrollMeeting;
          break;
        case 'followup':
          endpoint = ENDPOINTS.enrollFollowup;
          break;
        default:
          endpoint = ENDPOINTS.enrollNurture;
      }
      
      for (const contact of selectedContactsList) {
        try {
          await apiCall(endpoint, {
            email: contact.email,
            name: contact.name,
            workflow: workflow,
            contact_id: contact.id || contact.contact_id || contact.email
          });
        } catch (workflowError) {
          console.error(`Error enrolling ${contact.email} in ${workflow}:`, workflowError);
        }
      }
    }
    
    showStatus(`Enrolled ${selectedContactsList.length} contacts in ${selectedWorkflows.length} workflows`, false);
    selectedContacts.clear();
    updateSelectedCount();
    renderContactsTable();
    
    // Clear workflow checkboxes
    document.querySelectorAll('#workflowList input[type="checkbox"]').forEach(cb => cb.checked = false);
    
  } catch (error) {
    console.error('Error enrolling in workflows:', error);
    showStatus('Error enrolling contacts in workflows: ' + error.message, true);
  }
});

document.getElementById('enrichContactsBtn').addEventListener('click', async function() {
  if (selectedContacts.size === 0) {
    showStatus('Please select contacts to enrich', true);
    return;
  }
  
  try {
    const selectedContactsList = Array.from(selectedContacts).map(id => 
      allContacts.find(c => c.id === id || c.contact_id === id || c.email === id)
    ).filter(c => c && (c.email || c.linkedin));
    
    if (selectedContactsList.length === 0) {
      showStatus('No valid contacts selected for enrichment', true);
      return;
    }
    
    for (const contact of selectedContactsList) {
      const enrichmentData = {
        contact: {
          id: contact.id || contact.contact_id || contact.email,
          email: contact.email,
          linkedin: contact.linkedin || '',
          name: contact.name || '',
          domain: contact.domain || '',
          company: contact.company || ''
        }
      };
      
      try {
        await apiCall(ENDPOINTS.enrichContacts, enrichmentData);
      } catch (err) {
        console.error(`Error enriching contact ${contact.email}:`, err);
      }
    }
    
    showStatus(`Enrichment started for ${selectedContactsList.length} contacts!`, false);
    selectedContacts.clear();
    updateSelectedCount();
    
    // Reload contacts after delay
    setTimeout(() => loadContacts(), 5000);
    
  } catch (error) {
    console.error('Error enriching contacts:', error);
    showStatus('Error enriching contacts: ' + error.message, true);
  }
});

document.getElementById('deleteSelectedBtn').addEventListener('click', async function() {
  if (selectedContacts.size === 0) {
    showStatus('Please select contacts to delete', true);
    return;
  }

  if (!confirm(`Delete ${selectedContacts.size} selected contacts?`)) {
    return;
  }

  try {
    for (const contactId of selectedContacts) {
      await apiCall(ENDPOINTS.removeContact, {
        contact_id: contactId
      });
    }

    showStatus(`Deleted ${selectedContacts.size} contacts`, false);
    selectedContacts.clear();
    await loadContacts();
    
  } catch (error) {
    console.error('Error deleting contacts:', error);
    showStatus('Error deleting contacts', true);
  }
});

// Filter functionality
document.getElementById('searchFilter').addEventListener('input', function() {
  applyFilters();
});

document.getElementById('industryFilter').addEventListener('change', function() {
  applyFilters();
});

document.getElementById('cityFilter').addEventListener('change', function() {
  applyFilters();
});

document.getElementById('revenueFilter').addEventListener('change', function() {
  applyFilters();
});

document.getElementById('refreshBtn').addEventListener('click', function() {
  loadContacts();
});

document.getElementById('clearFiltersBtn').addEventListener('click', function() {
  document.getElementById('searchFilter').value = '';
  document.getElementById('industryFilter').value = '';
  document.getElementById('cityFilter').value = '';
  document.getElementById('revenueFilter').value = '';
  applyFilters();
});

function applyFilters() {
  const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
  const industry = document.getElementById('industryFilter').value;
  const city = document.getElementById('cityFilter').value;
  const revenue = document.getElementById('revenueFilter').value;
  
  filteredContacts = allContacts.filter(contact => {
    // Search filter
    if (searchTerm) {
      const searchableText = [
        contact.name || '',
        contact.company || '',
        contact.email || '',
        contact.industry || ''
      ].join(' ').toLowerCase();
      
      if (!searchableText.includes(searchTerm)) {
        return false;
      }
    }

    // Industry filter
    if (industry && contact.industry !== industry) {
      return false;
    }

    // City filter
    if (city && contact.city !== city) {
      return false;
    }

    // Revenue filter
    if (revenue) {
      const contactRevenue = parseFloat((contact.annual_revenue || '0').toString().replace(/[^0-9.]/g, ''));
      switch (revenue) {
        case '0-1M':
          if (contactRevenue >= 1000000) return false;
          break;
        case '1M-10M':
          if (contactRevenue < 1000000 || contactRevenue >= 10000000) return false;
          break;
        case '10M-50M':
          if (contactRevenue < 10000000 || contactRevenue >= 50000000) return false;
          break;
        case '50M+':
          if (contactRevenue < 50000000) return false;
          break;
      }
    }

    return true;
  });

  renderContactsTable();
}

// Close modals when clicking outside
window.addEventListener('click', function(event) {
  const modals = ['contactModal', 'addContactModal', 'customEmailModal', 'contactActionsModal'];
  modals.forEach(modalId => {
    const modal = document.getElementById(modalId);
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });
});

// Close modals with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const modals = ['contactModal', 'addContactModal', 'customEmailModal', 'contactActionsModal'];
    modals.forEach(modalId => {
      const modal = document.getElementById(modalId);
      if (modal.style.display === 'block') {
        modal.style.display = 'none';
      }
    });
  }
});

// Make functions globally available
window.showAddContactModal = showAddContactModal;
window.closeAddContactModal = closeAddContactModal;
window.showCustomEmailModal = showCustomEmailModal;
window.closeCustomEmailModal = closeCustomEmailModal;
window.showContactActionsModal = showContactActionsModal;
window.closeContactActionsModal = closeContactActionsModal;
window.closeModal = closeModal;
window.downloadSampleCSV = downloadSampleCSV;
window.toggleContactSelection = toggleContactSelection;
window.sendEmailToContact = sendEmailToContact;
window.createMeetingForContact = createMeetingForContact;
window.createSMSForContact = createSMSForContact;
window.makeCallToContact = makeCallToContact;
window.editContact = editContact;

// Tour functionality placeholder
function startTour() {
  console.log('Tour functionality would go here');
}
window.startTour = startTour;

</script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
}
.navbar {
  background-color: #0A3161;
  color: white;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.navbar nav ul {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}
.navbar nav ul li {
  margin: 0 10px;
}
.navbar nav ul li a {
  color: white;
  text-decoration: none;
}
.navbar .user-info {
  display: flex;
  align-items: center;
  gap: 10px;
}
.subscription-medallion {
  display: flex;
  align-items: center;
  gap: 10px;
  background: linear-gradient(45deg, #CD7F32, #A0522D);
  color: white;
  padding: 8px 15px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.logo img {
  height: 60px;
  width: auto;
  max-height: 100px;
}
.content {
  padding: 20px;
  max-width: 1600px;
  margin: 0 auto;
}
.page-title {
  font-size: 2.5rem;
  font-weight: bold;
  color: #0A3161;
  margin-bottom: 0.5rem;
}
.page-subtitle {
  font-size: 1.1rem;
  color: #666;
}
.card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  padding: 20px;
  margin-bottom: 20px;
}
.section-header {
  background: linear-gradient(135deg, #0A3161, #1a4c80);
  color: white;
  padding: 15px;
  margin: -20px -20px 20px -20px;
  border-radius: 8px 8px 0 0;
}
.credits-display {
  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  border: 1px solid #dee2e6;
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 15px;
  text-align: center;
}
.credits-number {
  font-size: 1.4em;
  font-weight: bold;
  color: #0A3161;
}
.linkedin-input-section {
  display: grid;
  grid-template-columns: 1fr 150px;
  gap: 15px;
  margin-bottom: 20px;
}
.form-group {
  margin-bottom: 15px;
}
.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #333;
}
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}
.generate-btn {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  transition: all 0.3s ease;
  display: block;
  margin: 20px auto;
}
.add-contact-section {
  display: flex;
  gap: 15px;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
button {
  background: #0A3161;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  margin: 2px;
}
button:hover {
  background: #083050;
}
button.secondary {
  background: #6c757d;
}
button.danger {
  background: #dc3545;
}
button.success {
  background: #28a745;
}
button.warning {
  background: #ffc107;
  color: #212529;
}
button.info {
  background: #17a2b8;
}
.workflow-section {
  background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
  border: 2px solid #bb133e;
}
.workflow-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 10px;
  margin-bottom: 15px;
}
.workflow-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
}
.filter-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}
.bulk-actions {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  align-items: center;
  flex-wrap: wrap;
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
}
.table-container {
  overflow-x: auto;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.contacts-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
}
.contacts-table th,
.contacts-table td {
  padding: 12px 8px;
  text-align: left;
  border-bottom: 1px solid #dee2e6;
  font-size: 13px;
}
.contacts-table th {
  background: #f8f9fa;
  font-weight: 600;
  color: #0A3161;
}
.checkbox-cell {
  width: 40px;
  text-align: center;
}
.csv-sample {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 15px;
  margin-top: 15px;
}
.csv-sample code {
  display: block;
  background: white;
  padding: 10px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 12px;
  white-space: pre-wrap;
  margin: 10px 0;
}
.status-message {
  padding: 10px;
  border-radius: 4px;
  margin: 10px 0;
  display: none;
  position: fixed;
  top: 80px;
  right: 20px;
  max-width: 400px;
  z-index: 1000;
}
.status-success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}
.status-error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background-color: #fefefe;
  margin: 5% auto;
  padding: 0;
  border-radius: 8px;
  width: 90%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
}
.modal-header {
  background: linear-gradient(135deg, #0A3161, #1a4c80);
  color: white;
  padding: 20px;
  border-radius: 8px 8px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.close {
  color: white;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.modal-body {
  padding: 20px;
}
footer {
  background: #0A3161;
  color: #fff;
  text-align: center;
  padding: 15px;
  margin-top: 20px;
}
footer a {
  color: #fff;
  margin-right: 15px;
  text-decoration: none;
}
</style>

</body>
</html>

  
